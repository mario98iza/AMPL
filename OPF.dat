# lectura de los datos del sistema
param Sbase :=   100;  # potencia base en MVA

# lectura de los datos de barra
param: OB:       Nombre  Tb      V0     th0      Pd       Qd     Pg0      Qg0      Vg    Qgmax    Qgmin     gsh     bsh    Vmax    Vmin 	Pgmax	Pgmin:=
#                              [pu]  [grad]    [MW]   [MVAr]    [MW]   [MVAr]    [pu]   [MVAr]   [MVAr]    [pu]    [pu]    [pu]    [pu]   	[pu]	[pu]
    	
       2 "Claytor  132"   2   1.043   -5.48    21.7     12.7    40.0     50.0   1.045     50.0    -40.0   0.000   0.000   1.0150   0.990	 50.0	00.0
       3 "Kumis    132"   0   1.021   -7.96     2.4      1.2     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
	   1 "Glen Lyn 132"   3   1.040    0.00     0.0      0.0   260.2    -16.1   1.060      0.0      0.0   0.000   0.000   1.0150   0.990     150.0	00.0
       4 "Hancock  132"   0   1.012   -9.62     7.6      1.6     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
       5 "Fieldale 132"   2   1.010  -14.37    94.2     19.0     0.0     37.0   1.010     40.0    -40.0   0.000   0.000   1.0150   0.990	 50.0	00.0
       6 "Roanoke  132"   0   1.010  -11.34     0.0      0.0     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
       7 "Blaine   132"   0   1.002  -13.12    22.8     10.9     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
       8 "Reusens  132"   2   1.010  -12.10    30.0     30.0     0.0     37.3   1.010     40.0    -10.0   0.000   0.000   1.0150   0.990	 50.0	00.0
       9 "Roanoke  132"   0   1.051  -14.38     0.0      0.0     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      10 "Roanoke   33"   0   1.045  -15.97     5.8      2.0     0.0      0.0   0.000      0.0      0.0   0.000   0.190   1.0150   0.990	 00.0	00.0
      11 "Roanoke   11"   2   1.022  -14.39     0.0      0.0     0.0     16.2   1.082     24.0     -6.0   0.000   0.000   1.0150   0.990	 50.0	00.0
      12 "Hancock   33"   0   1.057  -15.24    11.2      7.5     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      13 "Hancock   11"   2   1.041  -15.24     0.0      0.0     0.0     10.6   1.071     24.0     -6.0   0.000   0.000   1.0150   0.990	 50.0	00.0
      14 "Bus 14    33"   0   1.042  -16.13     6.2      1.6     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      15 "Bus 15    33"   0   1.038  -16.22     8.2      2.5     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      16 "Bus 16    33"   0   1.045  -15.83     3.5      1.8     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      17 "Bus 17    33"   0   1.040  -16.14     9.0      5.8     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      18 "Bus 18    33"   0   1.028  -16.82     3.2      0.9     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      19 "Bus 19    33"   0   1.026  -17.00     9.5      3.4     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      20 "Bus 20    33"   0   1.030  -16.80     2.2      0.7     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      21 "Bus 21    33"   0   1.033  -16.42    17.5     11.2     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      22 "Bus 22    33"   0   1.033  -16.41     0.0      0.0     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      23 "Bus 23    33"   0   1.027  -16.61     3.2      1.6     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      24 "Bus 24    33"   0   1.021  -16.78     8.7      6.7     0.0      0.0   0.000      0.0      0.0   0.000   0.043   1.0150   0.990	 00.0	00.0
      25 "Bus 25    33"   0   1.017  -16.35     0.0      0.0     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      26 "Bus 26    33"   0   1.000  -16.77     3.5      2.3     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      27 "Cloverdle 33"   0   1.023  -15.82     0.0      0.0     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      28 "Cloverdle132"   0   1.007  -11.97     0.0      0.0     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      29 "Bus 29    33"   0   1.003  -17.06     2.4      0.9     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
      30 "Bus 30    33"   0   0.992  -17.94    10.6      1.9     0.0      0.0   0.000      0.0      0.0   0.000   0.000   1.0150   0.990	 00.0	00.0
; 

# lectura de los datos de l neas y trafos: conjunto de ramales
param: OL:      
                 Tr      r         x    bshl       a    amax    amin      fi    Smax :=
#   k    i    j        [pu]      [pu]    [pu]                          [grad]   [MVA]
    1    1    2  0   0.0192    0.0575  0.0528  0.0000  0.0000  0.0000     0.0     220
    2    1    3  0   0.0452    0.1652  0.0408  0.0000  0.0000  0.0000     0.0     100
    3    2    4  0   0.0570    0.1737  0.0368  0.0000  0.0000  0.0000     0.0      55
    4    3    4  0   0.0132    0.0379  0.0084  0.0000  0.0000  0.0000     0.0      95
    5    2    5  0   0.0472    0.1983  0.0418  0.0000  0.0000  0.0000     0.0     100
    6    2    6  0   0.0581    0.1763  0.0374  0.0000  0.0000  0.0000     0.0      75
    7    4    6  0   0.0119    0.0414  0.0090  0.0000  0.0000  0.0000     0.0      90
    8    5    7  0   0.0460    0.1160  0.0204  0.0000  0.0000  0.0000     0.0      25
    9    6    7  0   0.0267    0.0820  0.0170  0.0000  0.0000  0.0000     0.0      45
   10    6    8  0   0.0120    0.0420  0.0090  0.0000  0.0000  0.0000     0.0      40
   11    6    9  1   0.0000    0.2080  0.0000  0.9780  1.1000  0.9000     0.0      35
   12    6   10  1   0.0000    0.5560  0.0000  0.9690  1.1000  0.9000     0.0      20
   13    9   11  0   0.0000    0.2080  0.0000  0.0000  0.0000  0.0000     0.0      20
   14    9   10  0   0.0000    0.1100  0.0000  0.0000  0.0000  0.0000     0.0      35
   15    4   12  1   0.0000    0.2560  0.0000  0.9320  1.1000  0.9000     0.0      60
   16   12   13  0   0.0000    0.1400  0.0000  0.0000  0.0000  0.0000     0.0      15
   17   12   14  0   0.1231    0.2559  0.0000  0.0000  0.0000  0.0000     0.0      10
   18   12   15  0   0.0662    0.1304  0.0000  0.0000  0.0000  0.0000     0.0      25
   19   12   16  0   0.0945    0.1987  0.0000  0.0000  0.0000  0.0000     0.0      10
   20   14   15  0   0.2210    0.1997  0.0000  0.0000  0.0000  0.0000     0.0       5
   21   16   17  0   0.0524    0.1923  0.0000  0.0000  0.0000  0.0000     0.0       5
   22   15   18  0   0.1073    0.2185  0.0000  0.0000  0.0000  0.0000     0.0      10
   23   18   19  0   0.0639    0.1292  0.0000  0.0000  0.0000  0.0000     0.0       5
   24   19   20  0   0.0340    0.0680  0.0000  0.0000  0.0000  0.0000     0.0      10
   25   10   20  0   0.0936    0.2090  0.0000  0.0000  0.0000  0.0000     0.0      15
   26   10   17  0   0.0324    0.0845  0.0000  0.0000  0.0000  0.0000     0.0      10
   27   10   21  0   0.0348    0.0749  0.0000  0.0000  0.0000  0.0000     0.0      25
   28   10   22  0   0.0727    0.1499  0.0000  0.0000  0.0000  0.0000     0.0      10
   29   21   22  0   0.0116    0.0236  0.0000  0.0000  0.0000  0.0000     0.0       5
   30   15   23  0   0.1000    0.2020  0.0000  0.0000  0.0000  0.0000     0.0      10
   31   22   24  0   0.1150    0.1790  0.0000  0.0000  0.0000  0.0000     0.0      10
   32   23   24  0   0.1320    0.2700  0.0000  0.0000  0.0000  0.0000     0.0       5
   33   24   25  0   0.1885    0.3292  0.0000  0.0000  0.0000  0.0000     0.0       5
   34   25   26  0   0.2544    0.3800  0.0000  0.0000  0.0000  0.0000     0.0       5
   35   25   27  0   0.1093    0.2087  0.0000  0.0000  0.0000  0.0000     0.0      10
   36   28   27  1   0.0000    0.3960  0.0000  0.9680  1.1000  0.9000     0.0      25
   37   27   29  0   0.2198    0.4153  0.0000  0.0000  0.0000  0.0000     0.0      10
   38   27   30  0   0.3202    0.6027  0.0000  0.0000  0.0000  0.0000     0.0      10
   39   29   30  0   0.2399    0.4533  0.0000  0.0000  0.0000  0.0000     0.0       5
   40    8   28  0   0.0636    0.2000  0.0428  0.0000  0.0000  0.0000     0.0       5
   41    6   28  0   0.0169    0.0599  0.0130  0.0000  0.0000  0.0000     0.0      25
; 

#inicializar variables y normalizar los datos del sistema para 

for {i in OB}{
   let Pd[i] := Pd[i]/Sbase;              # let asigna
   let Qd[i] := Qd[i]/Sbase;              #colocar en pu.
   let Qgmax[i] := Qgmax[i]/Sbase;        #colocar en pu.
   let Qgmin[i] := Qgmin[i]/Sbase;        #colocar en pu.
   let Pgmax[i] := Pgmax[i]/Sbase;             #colocar en pu
   let Pgmin[i] := Pgmin[i]/Sbase;  
   let V[i] := V0[i];                     #inicializando 
   let th[i] := th0[i]*3.14159/180;       #inicializando
   let Pg[i] := Pg0[i]/Sbase;             #inicializando
   let Qg[i] := Qg0[i]/Sbase; 
   }
for {(k,i,j) in OL}{
    let fi[k,i,j] := fi[k,i,j]*3.14159/180;
	let Smax[k,i,j] := Smax[k,i,j]/Sbase;
	if (Tr[k,i,j] == 0) then {
	   let a[k,i,j] := 1;
	 } else {
	   let a[k,i,j] := 1/a[k,i,j];
	   # let bshl [k,i,j] :=0;
	 }
	 let bshl[k,i,j] := bshl[k,i,j]/2;
     let g[k,i,j] := r[k,i,j]/(r[k,i,j]^2+x[k,i,j]^2);
	 let b[k,i,j] := -x[k,i,j]/(r[k,i,j]^2+x[k,i,j]^2);
     let Pde[k,i,j] := 0.0;
	 let Qde[k,i,j] := 0.0;
	 let Ppa[k,i,j] := 0.0;
	 let Qpa[k,i,j] := 0.0;
}
 #fijar la magnitud de tension en las barras de generaci√≥n
 #fix{i in OB:
 
#fix{i in OB : Tb[i] == 2  ||  Tb[i] == 3} V[i] := V0[i];
 
 #fijar la alimentacion de potencia activa de las barras de cargas
#fix{i in OB : Tb[i] == 2} Pg[i] := Pg0[i]/Sbase;
#fix{i in OB : Tb[i] == 0} Pg[i] := 0.0;

#Fijar la alimentacion de potencia reactiva de las barras de cargas
fix {i in OB : Tb[i] == 0} Qg[i] := 0.0;

#fijar el angulo de fase en la referencia
fix{i in OB : Tb[i] == 3} th[i] := th[i]*3.14159/180; 
 	 
	 
	   
	   
	   
	   
	